<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mypage">

<select id="getCnt" resultType="integer" parameterType="hashmap">
SELECT COUNT(*) AS CNT
FROM BOARD_TYPE T INNER JOIN  BULLETIN_BOARD B 
	ON T.BLTNBOARD_NO = B.BLTNBOARD_NO
WHERE B.DEL_DT IS NULL
<if test="searchTxt != null and searchTxt !=''">
	<choose>
		<when test="searchGbn eq 0">
		AND TITLE LIKE '%' || #{searchTxt} || '%'
		</when>
		<when test="searchGbn eq 1">
		AND CONTENTS LIKE '%'|| #{searchTxt}||'%'
		</when>
	</choose>		
</if>	
</select>

<select id="getBoardList" resultType="hashmap">
SELECT F.POST_NO,F.BLTNBOARD_NM,F.TITLE,F.REG_DT, F.CONTENTS
FROM(SELECT B.POST_NO, T.BLTNBOARD_NM, B.TITLE, B.CONTENTS,
	 	CASE WHEN TO_CHAR(B.REG_DT, 'YY.MM.DD') = TO_CHAR(SYSDATE,'YY.MM.DD')
            	THEN TO_CHAR(B.REG_DT, 'HH24:MI')
            	ELSE TO_CHAR(B.REG_DT,'YY.MM.DD')
       			END AS REG_DT,
              ROW_NUMBER() OVER(ORDER BY B.POST_NO DESC) AS RNUM  
FROM BULLETIN_BOARD B INNER JOIN BOARD_TYPE T
		ON B.BLTNBOARD_NO = T.BLTNBOARD_NO
WHERE B.DEL_DT IS NULL
<if test="searchTxt != null and searchTxt !=''">
	<choose>
		<!-- 구분이 제목일때  #{serchTxt} 들어가묜-->
		<when test="searchGbn eq 0">
		AND TITLE LIKE '%' || #{searchTxt} || '%'
		</when>
		<when test="searchGbn eq 1">
		AND CONTENTS LIKE '%'|| #{searchTxt}||'%'
		</when>
	</choose>		
</if>
)F
WHERE F.RNUM BETWEEN #{start} AND #{end}		
</select>
	


</mapper>