<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="adComment">



<!-- 목록 -->
<select id="list" resultType="hashmap">
SELECT  A.MEMBER_NO, A.BLTNBOARD_NM, A.NM, A.EMAIL, A.CONTENTS, A.REG_DT, A.RNK, A.COMMENT_NO
FROM(	SELECT M.MEMBER_NO, BT.BLTNBOARD_NM, M.NM, M.EMAIL, C.CONTENTS, C.COMMENT_NO, C.REG_DT,
			ROW_NUMBER()OVER( ORDER BY C.REG_DT DESC) AS RNK
		FROM MEMBER M INNER JOIN COMMENTS C
                			ON M.MEMBER_NO = C.MEMBER_NO
               			INNER JOIN BULLETIN_BOARD B
                			ON C.POST_NO = B.POST_NO
               			INNER JOIN BOARD_TYPE BT
                			ON B.BLTNBOARD_NO = BT.BLTNBOARD_NO
		WHERE C.DEL_DT IS NULL)A
WHERE A.RNK BETWEEN #{start} AND ${end}
<if test="searchTxt != null and searchTxt !='' ">
			<choose>
				<when test="searchGbn == 0">
					AND CONTENTS LIKE '%' || #{searchTxt} || '%'
				</when>
				<when test="searchGbn == 1">
					AND NM LIKE '%' || #{searchTxt} || '%'		
				</when>
			</choose>
		</if>
</select>




<!-- 페이징 -->
	<select id="cnt" parameterType="hashmap" resultType="integer">	
		SELECT COUNT(*) AS CNT
FROM MEMBER M INNER JOIN COMMENTS C
                			ON M.MEMBER_NO = C.MEMBER_NO
               			INNER JOIN BULLETIN_BOARD B
                			ON C.POST_NO = B.POST_NO
               			INNER JOIN BOARD_TYPE BT
                			ON B.BLTNBOARD_NO = BT.BLTNBOARD_NO
WHERE C.DEL_DT IS NULL	
		<if test="searchTxt != null and searchTxt !='' ">
			<choose>
				<when test="searchGbn == 0">
					AND C.CONTENTS LIKE '%' || #{searchTxt} || '%'
				</when>
				<when test="searchGbn == 1">
					AND M.NM LIKE '%' || #{searchTxt} || '%'		
				</when>
			</choose>
		</if>
	</select>


<!-- 체크박스 삭제 -->
<update id ="checkDel" parameterType="hashmap">
UPDATE COMMENTS SET DEL_DT = SYSDATE
WHERE COMMENT_NO IN (${no})
</update>

<!-- 개별 삭제 -->
<update id ="del" parameterType="hashmap">
UPDATE COMMENTS SET DEL_DT = SYSDATE
WHERE COMMENT_NO = #{no}
</update>
</mapper>