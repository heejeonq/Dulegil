<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="adWebTotal">



	<!-- 전체 통계 -->
	<select id="list" resultType="hashmap">
		SELECT MEMCNT, POSTCNT, CMTCNT, ACPCNT
		FROM (  SELECT COUNT(*) AS MEMCNT
		        FROM MEMBER
		        WHERE AUTHORITY_NO != 1) M  LEFT JOIN ( SELECT COUNT(*) AS POSTCNT
		                                              	FROM BULLETIN_BOARD           )P
		                                    ON 1=1
		                                    LEFT JOIN ( SELECT COUNT(*) AS CMTCNT
		                                                FROM COMMENTS               )C
		                                    ON 1=1
		                                    LEFT JOIN ( SELECT COUNT(*) AS ACPCNT
		                                                FROM BOARD_ACCOMPANY        )A
		                                    ON 1=1
	</select>

	


	
	<!-- 연도 별 통계 -->
	<select id="year" resultType="hashmap">
		SELECT M.YEAR, M.MEM, P.POST, C.CMT, A.ACOM
		FROM ( 	SELECT TO_CHAR(REG_DT, 'YYYY') AS YEAR, COUNT(*) AS MEM    
        		FROM MEMBER
		        WHERE REG_DT >= '20180101' 
		          AND REG_DT <![CDATA[ < ]]>= '20221001'
		          AND AUTHORITY_NO != 1
		        GROUP BY TO_CHAR(REG_DT, 'YYYY'))M  INNER JOIN (    SELECT TO_CHAR(REG_DT, 'YYYY') AS YEAR, COUNT(*) AS POST    
		                                                            FROM BULLETIN_BOARD 
		                                                            WHERE REG_DT >= '20180101' 
		                                                              AND REG_DT <![CDATA[ < ]]>= '20221001'
		                                                            GROUP BY TO_CHAR(REG_DT, 'YYYY')                            )P
		                                                ON M.YEAR = P.YEAR
		                                                
		                                                
		                                            INNER JOIN (    SELECT TO_CHAR(REG_DT, 'YYYY') AS YEAR, COUNT(*) AS CMT    
		                                                            FROM COMMENTS 
		                                                            WHERE REG_DT >= '20180101' 
		                                                              AND REG_DT <![CDATA[ < ]]>= '20221001'
		                                                            GROUP BY TO_CHAR(REG_DT, 'YYYY')                            )C
		                                                ON M.YEAR = C.YEAR
		                                                    
		                                            INNER JOIN (    SELECT TO_CHAR(P.REG_DT, 'YYYY') AS YEAR, COUNT(*) AS ACOM    
		                                                            FROM BOARD_ACCOMPANY A INNER JOIN BULLETIN_BOARD P
		                                                                                    ON A.POST_NO = P.POST_NO
		                                                            WHERE P.REG_DT >= '20180101' 
		                                                              AND P.REG_DT <![CDATA[ < ]]>= '20221001'
		                                                            GROUP BY TO_CHAR(P.REG_DT, 'YYYY')                          )A
		                                                ON M.YEAR = A.YEAR

	</select>






	<!-- 월 별 통계 -->
	<select id="month" resultType="hashmap">
		SELECT M.MONTH, M.MEM, P.POST, C.CMT, A.ACOM
		FROM ( 	SELECT TO_CHAR(REG_DT, 'YYYYMM') AS MONTH, COUNT(*) AS MEM    
		        FROM MEMBER
		        WHERE REG_DT >= '20180101' 
		          AND REG_DT <![CDATA[ < ]]>= '20221001'
		          AND AUTHORITY_NO != 1
		        GROUP BY TO_CHAR(REG_DT, 'YYYYMM'))M  LEFT OUTER JOIN ( SELECT TO_CHAR(REG_DT, 'YYYYMM') AS MONTH, COUNT(*) AS POST    
			                                                            FROM BULLETIN_BOARD 
			                                                            WHERE REG_DT >= '20180101' 
			                                                              AND REG_DT <![CDATA[ < ]]>= '20221001'
			                                                            GROUP BY TO_CHAR(REG_DT,'YYYYMM')                            )P
			                                                ON M.MONTH = P.MONTH
			                                                
			                                                
			                                            LEFT OUTER JOIN (   SELECT TO_CHAR(REG_DT, 'YYYYMM') AS MONTH, COUNT(*) AS CMT    
				                                                            FROM COMMENTS 
				                                                            WHERE REG_DT >= '20180101' 
				                                                              AND REG_DT <![CDATA[ < ]]>= '20221001'
				                                                            GROUP BY TO_CHAR(REG_DT, 'YYYYMM')                            )C
			                                                ON M.MONTH = C.MONTH
			                                                    
			                                            LEFT OUTER JOIN (   SELECT TO_CHAR(P.REG_DT, 'YYYYMM') AS MONTH, COUNT(*) AS ACOM    
				                                                            FROM BOARD_ACCOMPANY A INNER JOIN BULLETIN_BOARD P
				                                                                                    ON A.POST_NO = P.POST_NO
				                                                            WHERE P.REG_DT >= '20180101' 
				                                                              AND P.REG_DT <![CDATA[ < ]]>= '20221001'
				                                                            GROUP BY TO_CHAR(P.REG_DT, 'YYYYMM')                          )A
			                                                ON M.MONTH = A.MONTH

	</select>












	<!-- 일 별 통계 -->
	<select id="day" resultType="hashmap">
	SELECT M.DAY, M.MEM, P.POST, C.CMT, A.ACOM
	FROM (  SELECT TO_CHAR(REG_DT, 'YYYYMMDD') AS DAY, COUNT(*) AS MEM    
        	FROM MEMBER
       		 WHERE REG_DT >= '20180101' AND REG_DT <![CDATA[ < ]]> = '20221001'
          	 AND AUTHORITY_NO != 1
        	GROUP BY TO_CHAR(REG_DT, 'YYYYMMDD'))M  LEFT OUTER JOIN (   SELECT TO_CHAR(REG_DT, 'YYYYMMDD') AS DAY, COUNT(*) AS POST    
		                                                            FROM BULLETIN_BOARD 
		                                                            WHERE REG_DT >= '20180101' 
		                                                              AND REG_DT<![CDATA[ < ]]> = '20221001'
				                                                            GROUP BY TO_CHAR(REG_DT,'YYYYMMDD')                            )P
		                                                ON M.DAY = P.DAY
		                                                
		                                                
		                                            LEFT OUTER JOIN (   SELECT TO_CHAR(REG_DT, 'YYYYMMDD') AS DAY, COUNT(*) AS CMT    
			                                                            FROM COMMENTS 
			                                                            WHERE REG_DT >= '20180101' 
			                                                              AND REG_DT <![CDATA[ < ]]> = '20221001'
			                                                            GROUP BY TO_CHAR(REG_DT, 'YYYYMMDD')                            )C
		                                                ON M.DAY = C.DAY
		                                                    
		                                            LEFT OUTER JOIN (   SELECT TO_CHAR(P.REG_DT, 'YYYYMMDD') AS DAY, COUNT(*) AS ACOM    
			                                                            FROM BOARD_ACCOMPANY A INNER JOIN BULLETIN_BOARD P
			                                                                                    ON A.POST_NO = P.POST_NO
			                                                            WHERE P.REG_DT >= '20180101' 
			                                                              AND P.REG_DT <![CDATA[ < ]]> = '20221001'
			                                                            GROUP BY TO_CHAR(P.REG_DT, 'YYYYMMDD')                          )A
		                                                ON M.DAY = A.DAY

	</select>

</mapper>