<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="adWebTotal">



	<!-- 목록 -->
	<select id="list" resultType="hashmap">
		SELECT MEMCNT, POSTCNT, CMTCNT, ACPCNT
		FROM (  SELECT COUNT(*) AS MEMCNT
		        FROM MEMBER
		        WHERE AUTHORITY_NO != 1) M  LEFT JOIN ( SELECT COUNT(*) AS POSTCNT
		                                              	FROM BULLETIN_BOARD           )P
		                                    ON 1=1
		                                    LEFT JOIN ( SELECT COUNT(*) AS CMTCNT
		                                                FROM COMMENTS               )C
		                                    ON 1=1
		                                    LEFT JOIN ( SELECT COUNT(*) AS ACPCNT
		                                                FROM BOARD_ACCOMPANY        )A
		                                    ON 1=1
	</select>

	


	<!-- 페이징 -->
	<select id="cnt" parameterType="hashmap" resultType="integer">
	SELECT COUNT(*) AS CNT
	FROM REPORT R INNER JOIN REPORT_TYPE RT
		ON R.REPORT_TYPE_NO = RT.REPORT_TYPE_NO
		LEFT JOIN MEMBER P
		ON R.TARGET_REPORT_MEMBER_NO = P.MEMBER_NO
		LEFT JOIN MEMBER C
		ON R.REPORT_MEMBER_NO = C.MEMBER_NO
		WHERE R.DEL_DT IS NULL

		<if test="searchTxt != null and searchTxt != ''">
			<choose>
				<when test="searchGbn == 0">
					AND CATE LIKE '%' || #{searchTxt} || '%'
				</when>
				<when test="searchGbn == 1">
					AND ACCUSER '%' || #{searchTxt} || '%'
				</when>
				<when test="searchGbn == 2">
					AND ACCUSED LIKE '%' || #{searchTxt} || '%'
				</when>
				<when test="searchGbn == 3">
					AND REPORT_TYPE_NM LIKE '%' || #{searchTxt} || '%'
				</when>
			</choose>
		</if>
	</select>


	<!-- 더보기 - 댓글 -->
	<select id="comment" resultType="hashmap">
	 SELECT R.REPORT_NO,C.POST_NO, BT.BLTNBOARD_NM, PO.NM AS PNM, P.TITLE, P.REG_DT, P.CONTENTS AS POST, C.COMMENT_NO,M.NM AS CNM,M.IMG_FILE,C.CONTENTS AS CMT
	FROM COMMENTS C INNER JOIN REPORT R
                ON C.COMMENT_NO = R.COMMENT_NO
                INNER JOIN BULLETIN_BOARD P
                ON C.POST_NO = P.POST_NO
                INNER JOIN MEMBER PO
                ON P.MEMBER_NO = PO.MEMBER_NO
                INNER JOIN BOARD_TYPE BT
                ON P.BLTNBOARD_NO = BT.BLTNBOARD_NO
                INNER JOIN MEMBER M
                ON M.MEMBER_NO= C.MEMBER_NO
	WHERE R.REPORT_NO = #{rptNoC}
	</select>






</mapper>