<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="accompany">
<select id="applyMemList" resultType="hashmap" parameterType="hashmap">
	SELECT BLT.MEMBER_NO, M.MEMBER_NO, M.IMG_FILE, M.NM, M.RELIABILITY, BA.ACCOMPANY_DT, BLT.TITLE,
      	   BC.COURSE_NO,BLT.POST_NO,M.GENDER, TRUNC(MONTHS_BETWEEN(SYSDATE, M.DATE_BIRTH)/12) AS AGE,
      	   BA.PUBLIC_GENDER, BA.PUBLIC_AGE
	FROM BULLETIN_BOARD BLT INNER JOIN BOARD_COURSE BC
	                                ON BLT.POST_NO = BC.POST_NO
	                                AND BLT.DEL_DT IS NULL
	                        INNER JOIN BOARD_ACCOMPANY BA
	                                ON BC.POST_NO = BA.POST_NO
	                        INNER JOIN ACCOMPANY_APPLY AA
	                                ON AA.POST_NO = BLT.POST_NO
	                        INNER JOIN MEMBER M
	                                ON AA.MEMBER_NO = M.MEMBER_NO
	                        INNER JOIN MEMBER M
	                                ON BLT.MEMBER_NO = M.MEMBER_NO
	WHERE BLT.MEMBER_NO = #{memNo}  
	AND TO_CHAR(BA.ACCOMPANY_DT, 'YY.MM.DD') >= TO_CHAR(SYSDATE, 'YY.MM.DD')                      
</select>

<select id="chatList" resultType="hashmap" parameterType="hashmap">
	SELECT TITLE 
	FROM BULLETIN_BOARD
	WHERE MEMBER_NO = #{memNo}
	AND BLTNBOARD_NO = 2     
	AND BULLETIN_BOARD.DEL_DT IS NULL                           
</select>

<select id="myApply" resultType="hashmap" parameterType="hashmap">
	SELECT AA.STATE_NO, TO_CHAR(AA.REG_DT,'YYYY.MM.DD') AS REG_DT, BB.TITLE, MEM.NM, BC.COURSE_NO, BB.POST_NO
	FROM ACCOMPANY_APPLY AA INNER JOIN MEMBER M
	                                ON AA.MEMBER_NO = M.MEMBER_NO
	                        INNER JOIN BULLETIN_BOARD BB
	                                ON AA.POST_NO = BB.POST_NO
	                                AND BB.DEL_DT IS NULL
	                        INNER JOIN BOARD_COURSE BC
	                                ON BB.POST_NO = BC.POST_NO
	                        INNER JOIN MEMBER MEM
	                                ON MEM.MEMBER_NO = BB.MEMBER_NO  
	 WHERE M.MEMBER_NO = #{memNo}                                                                                           
</select>

<update id="applyMemUpdate" parameterType="hashmap">
	UPDATE ACCOMPANY_APPLY SET STATE_NO = #{stateNo}
    WHERE MEMBER_NO = #{memNo}
    AND POST_NO = #{postNo}
	</update>
</mapper>